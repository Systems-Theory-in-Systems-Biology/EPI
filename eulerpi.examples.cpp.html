<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>External C++ Models &mdash; EPI  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=5c84b33f" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="C++ Plant Model" href="eulerpi.examples.cpp.cpp_plant.html" />
    <link rel="prev" title="Menten Model" href="eulerpi.examples.sbml.sbml_menten_model.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            EPI
              <img src="_static/epi.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="eulerpi.core.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_material/tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Example Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="eulerpi.examples.temperature.temperature.html">Earth Temperature Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="eulerpi.examples.corona.corona.html">Corona SEIR Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="eulerpi.examples.heat.heat.html">Heat Conduction Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="eulerpi.examples.sbml.html">SBML Models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">External C++ Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparation">Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-model-definition">C++ Model Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wrapping-the-c-code">Wrapping the C++ Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compilation">Compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python-side-model">Python Side Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#submodules">Submodules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="eulerpi.examples.cpp.cpp_plant.html">C++ Plant Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html">Python Plant Model</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="MarkdownLinks/development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="MarkdownLinks/contributing.html">Contributing to EPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="MarkdownLinks/license.html">LICENSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="MarkdownLinks/citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="MarkdownLinks/changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EPI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="examples.html">Example Models</a></li>
      <li class="breadcrumb-item active">External C++ Models</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/eulerpi.examples.cpp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="external-c-models">
<h1>External C++ Models<a class="headerlink" href="#external-c-models" title="Link to this heading"></a></h1>
<p>Many libraries in the field of scientific computing are written in C++
to achieve fast code execution and do not have python bindings. The C++ model example shows how you can
call C++ code from your python <a class="reference internal" href="eulerpi.core.model.html#eulerpi.core.model.Model" title="eulerpi.core.model.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> class.
It is primarily intended for fast implementations of the <cite>forward</cite> and <cite>jacobian</cite> method.</p>
<p>This example model uses the following features:</p>
<ul class="simple">
<li><p>Calling C++ Code: Calls external c++ code using pybind11</p></li>
<li><p>Performance Comparison: The file <code class="file docutils literal notranslate"><span class="pre">eulerpi/examples/cpp/python_reference_plants.py</span></code> includes
python models implementing the same mapping. You can compare the performance of the different approaches.</p></li>
</ul>
<section id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>cmake
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>pybind11
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>eigen3-dev
sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/usr/include/eigen3/Eigen<span class="w"> </span>/usr/include/Eigen
</pre></div>
</div>
</section>
<section id="c-model-definition">
<h2>C++ Model Definition<a class="headerlink" href="#c-model-definition" title="Link to this heading"></a></h2>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef MY_CPP_MODEL</span>
<span class="cp">#define MY_CPP_MODEL</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pybind11/stl.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pybind11/numpy.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pybind11/eigen.h&gt;</span>

<span class="c1">// Returned from py::array_t&lt;double&gt;.request()</span>
<span class="c1">// struct buffer_info {</span>
<span class="c1">//     void *ptr;</span>
<span class="c1">//     size_t itemsize;</span>
<span class="c1">//     std::string format;</span>
<span class="c1">//     int ndim;</span>
<span class="c1">//     std::vector&lt;size_t&gt; shape;</span>
<span class="c1">//     std::vector&lt;size_t&gt; strides;</span>
<span class="c1">// };</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">py</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">pybind11</span><span class="p">;</span>

<span class="c1">// Mapping from </span>
<span class="n">py</span><span class="o">::</span><span class="n">array_t</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">forward</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="n">array_t</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">py</span><span class="o">::</span><span class="n">buffer_info</span><span class="w"> </span><span class="n">bufParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param</span><span class="p">.</span><span class="n">request</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Storage for the result</span>
<span class="w">    </span><span class="n">py</span><span class="o">::</span><span class="n">array_t</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py</span><span class="o">::</span><span class="n">array</span><span class="p">(</span><span class="n">py</span><span class="o">::</span><span class="n">buffer_info</span><span class="p">(</span>
<span class="w">        </span><span class="k">nullptr</span><span class="p">,</span><span class="w">            </span><span class="cm">/* Pointer to data (nullptr -&gt; ask NumPy to allocate!) */</span>
<span class="w">        </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span><span class="w">     </span><span class="cm">/* Size of one item */</span>
<span class="w">        </span><span class="n">py</span><span class="o">::</span><span class="n">format_descriptor</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Buffer format */</span>
<span class="w">        </span><span class="mi">1</span><span class="p">,</span><span class="w">          </span><span class="cm">/* How many dimensions? */</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">},</span><span class="w">  </span><span class="cm">/* Number of elements for each dimension */</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="cm">/* Strides for each dimension */</span>
<span class="w">    </span><span class="p">));</span>
<span class="w">    </span><span class="n">py</span><span class="o">::</span><span class="n">buffer_info</span><span class="w"> </span><span class="n">bufRes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">request</span><span class="p">();</span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ptrParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="n">bufParam</span><span class="p">.</span><span class="n">ptr</span><span class="p">);</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ptrRes</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="n">bufRes</span><span class="p">.</span><span class="n">ptr</span><span class="p">);</span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">water</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptrParam</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">sun</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ptrParam</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">size</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">water</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sun</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">water</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sun</span><span class="p">);</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">flies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exp</span><span class="p">(</span><span class="n">water</span><span class="p">)</span><span class="mf">-0.999</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">ptrRes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="w">    </span><span class="n">ptrRes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">green</span><span class="p">;</span>
<span class="w">    </span><span class="n">ptrRes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flies</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// If using Eigen::Ref, prevent copy of data by using RowMajoger storage order which is also used in numpy</span>
<span class="c1">// using RowMatrixXd = Eigen::Matrix&lt;double, Eigen::Dynamic, Eigen::Dynamic, Eigen::RowMajor&gt;;</span>
<span class="c1">// https://pybind11.readthedocs.io/en/stable/advanced/cast/eigen.html</span>

<span class="k">typedef</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Matrix32d</span><span class="p">;</span>
<span class="c1">//Jacobian for f:R^n -&gt; R^m is Jf:R^m -&gt; R^n = R^mxn</span>
<span class="n">Matrix32d</span><span class="w"> </span><span class="nf">jacobian</span><span class="p">(</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="w"> </span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Matrix32d</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">param</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="w">    </span><span class="n">res</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">param</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="w">    </span><span class="n">res</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exp</span><span class="p">(</span><span class="n">param</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="w">    </span><span class="n">res</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif</span>
</pre></div>
</div>
</section>
<section id="wrapping-the-c-code">
<h2>Wrapping the C++ Code<a class="headerlink" href="#wrapping-the-c-code" title="Link to this heading"></a></h2>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// pybind11_wrapper.cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pybind11/pybind11.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;cpp_model.hpp&quot;</span>

<span class="n">PYBIND11_MODULE</span><span class="p">(</span><span class="n">cpp_model</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">doc</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;C++ EPI Model implemented with pybind11&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Optional module docstring</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">&quot;forward&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">forward</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A function that calculates the forward pass&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">def</span><span class="p">(</span><span class="s">&quot;jacobian&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">jacobian</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A function that calculates the jacobian&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The example code is inconsistent in the following way:
It uses a normal array for the forward method,
but an eigen vector as input and an eigen matrix as output
for the jacobian method. This allows to show us how to write wrapper code
for normal arrays as well as for eigen objects. On the python side exclusively
numpy 1d/2d arrays will be used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The C++ code is wrapped using pybind11. For more information on how to use pybind11 see:
* PyBind11 Documentation: <a class="reference external" href="https://pybind11.readthedocs.io/en/stable/">https://pybind11.readthedocs.io/en/stable/</a>
* PyBind11 Eigen Notes: <a class="reference external" href="https://pybind11.readthedocs.io/en/stable/advanced/cast/eigen.html">https://pybind11.readthedocs.io/en/stable/advanced/cast/eigen.html</a></p>
</div>
</section>
<section id="compilation">
<h2>Compilation<a class="headerlink" href="#compilation" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/eulerpi/examples/cpp/
mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..
make<span class="w"> </span>-j
</pre></div>
</div>
</section>
<section id="python-side-model">
<h2>Python Side Model<a class="headerlink" href="#python-side-model" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">eulerpi.core.model</span> <span class="kn">import</span> <span class="n">ArtificialModelInterface</span><span class="p">,</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">eulerpi.examples.cpp</span> <span class="kn">import</span> <span class="n">cpp_model</span>


<span class="k">class</span> <span class="nc">CppPlant</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">ArtificialModelInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A plant model which uses a c++ library with eigen3 to evaluate the forward pass and the gradient</span>
<span class="sd">    Param0: Water [0,1]</span>
<span class="sd">    Param1: Sun   [0,1]</span>
<span class="sd">    Data0: Size [0,2] # the more water and sun the better</span>
<span class="sd">    Data1: Health [0,1], to much water is not good, too much sun is not good</span>
<span class="sd">    Data2: Sciarid ;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">param_dim</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">data_dim</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">PARAM_LIMITS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">CENTRAL_PARAM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">central_param</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">CENTRAL_PARAM</span><span class="p">,</span>
        <span class="n">param_limits</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">PARAM_LIMITS</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">central_param</span><span class="p">,</span>
            <span class="n">param_limits</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cpp_model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cpp_model</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_artificial_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>You can use the cpp example model as template for your own C++ Model.</p>
</section>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="eulerpi.examples.cpp.cpp_plant.html">C++ Plant Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html">Python Plant Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.ExternalPlant"><code class="docutils literal notranslate"><span class="pre">ExternalPlant</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.ExternalPlant.forward"><code class="docutils literal notranslate"><span class="pre">ExternalPlant.forward()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.ExternalPlant.generate_artificial_params"><code class="docutils literal notranslate"><span class="pre">ExternalPlant.generate_artificial_params()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.ExternalPlant.jacobian"><code class="docutils literal notranslate"><span class="pre">ExternalPlant.jacobian()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.ExternalPlant.CENTRAL_PARAM"><code class="docutils literal notranslate"><span class="pre">ExternalPlant.CENTRAL_PARAM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.ExternalPlant.PARAM_LIMITS"><code class="docutils literal notranslate"><span class="pre">ExternalPlant.PARAM_LIMITS</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.ExternalPlant.data_dim"><code class="docutils literal notranslate"><span class="pre">ExternalPlant.data_dim</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.ExternalPlant.param_dim"><code class="docutils literal notranslate"><span class="pre">ExternalPlant.param_dim</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.JaxPlant"><code class="docutils literal notranslate"><span class="pre">JaxPlant</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.JaxPlant.forward"><code class="docutils literal notranslate"><span class="pre">JaxPlant.forward()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.JaxPlant.generate_artificial_params"><code class="docutils literal notranslate"><span class="pre">JaxPlant.generate_artificial_params()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.JaxPlant.CENTRAL_PARAM"><code class="docutils literal notranslate"><span class="pre">JaxPlant.CENTRAL_PARAM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.JaxPlant.PARAM_LIMITS"><code class="docutils literal notranslate"><span class="pre">JaxPlant.PARAM_LIMITS</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.JaxPlant.data_dim"><code class="docutils literal notranslate"><span class="pre">JaxPlant.data_dim</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="eulerpi.examples.cpp.python_reference_plants.html#eulerpi.examples.cpp.python_reference_plants.JaxPlant.param_dim"><code class="docutils literal notranslate"><span class="pre">JaxPlant.param_dim</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="eulerpi.examples.sbml.sbml_menten_model.html" class="btn btn-neutral float-left" title="Menten Model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="eulerpi.examples.cpp.cpp_plant.html" class="btn btn-neutral float-right" title="C++ Plant Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, Vincent Wagner, Sebastian Höpfl, Lars Kaiser.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>