<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Development &mdash; EPI  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing to EPI" href="contributing.html" />
    <link rel="prev" title="C++ Model" href="../examples/cpp_example.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            EPI
              <img src="../_static/epi.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../modules.html">API DOC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_material/tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Example Models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#maintaining-the-repository">Maintaining the repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dependency-management-with-poetry">Dependency Management with Poetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-quality-checks">Code quality checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#profiling-with-scalene">Profiling with scalene</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documentation-with-sphinx">Documentation with Sphinx</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hosting-with-github-pages">Hosting with GitHub Pages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#changelog">Changelog</a></li>
<li class="toctree-l3"><a class="reference internal" href="#versioning">Versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-deployment-with-testpypi">Test Deployment with TestPyPi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deployment-with-pypi">Deployment with PyPi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#jax-with-cuda">Jax with CUDA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to EPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">LICENSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EPI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Development</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/MarkdownLinks/development.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="development">
<h1>Development<a class="headerlink" href="#development" title="Link to this heading"></a></h1>
<section id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading"></a></h2>
<ul>
<li><p>Clone the repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Systems-Theory-in-Systems-Biology/EPI.git
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:Systems-Theory-in-Systems-Biology/EPI.git
</pre></div>
</div>
<details>
<summary>Should I choose https or ssh?</summary>
You can clone the repository over https or ssh. Use https if you only want to obtain the code. Use ssh if you are a registered as developer on the repository and want to push changes to the code base. If you want to contribute to the project but are not a registered developer, create a fork of the project first. In this case, you have to clone your fork, not this repository. </details>
</li>
<li><p>Install <a class="reference external" href="https://python-poetry.org/docs/">poetry</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-sSL<span class="w"> </span>https://install.python-poetry.org<span class="w"> </span><span class="p">|</span><span class="w"> </span>python3<span class="w"> </span>-
</pre></div>
</div>
</li>
<li><p>Install dependencies:</p>
<ul>
<li><p>For amici (sbml):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>swig
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libblas-dev
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libatlas-base-dev
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libhdf5-dev
</pre></div>
</div>
</li>
<li><p>For cpp:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>cmake
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libeigen3-dev
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>pybind11-dev
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Install eulerpi:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>install<span class="w"> </span>--with<span class="o">=</span>dev<span class="w"> </span>--extras<span class="o">=</span>sbml
</pre></div>
</div>
</li>
<li><p>Run the tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>pytest
</pre></div>
</div>
<p>You can add the <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> parameter to get a more detailed report.</p>
</li>
</ul>
</section>
<section id="maintaining-the-repository">
<h2>Maintaining the repository<a class="headerlink" href="#maintaining-the-repository" title="Link to this heading"></a></h2>
<p>Here are the most important information on how to maintain this repository.</p>
<section id="dependency-management-with-poetry">
<h3>Dependency Management with Poetry<a class="headerlink" href="#dependency-management-with-poetry" title="Link to this heading"></a></h3>
<p>We use poetry as build system, for the dependency management and the virtual environment. During the <a class="reference external" href="#quickstart">Quickstart</a> we installed all dependencies into the virtual environment, therefore:</p>
<hr class="docutils" />
<p><strong>IMPORTANT</strong></p>
<p>Run all commands in the next section in the poetry shell. It can be started with <code class="docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">shell</span></code>. Alternatively, you can run commands with <code class="docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">run</span> <span class="pre">&lt;yourcommand&gt;</span></code>.</p>
<hr class="docutils" />
<p>Run <code class="docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">add</span> <span class="pre">package_name</span></code> to add the library/package with the name <code class="docutils literal notranslate"><span class="pre">package_name</span></code> as dependencie to your project. Use <code class="docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">add</span> <span class="pre">--group</span> <span class="pre">dev</span> <span class="pre">package_name</span></code> to add <code class="docutils literal notranslate"><span class="pre">package_name</span></code> to your <code class="docutils literal notranslate"><span class="pre">dev</span></code> dependencies. You can have arbitrary group names.</p>
<p>For more information read the <a class="reference external" href="https://python-poetry.org/docs/basic-usage/#initialising-a-pre-existing-project">Poetry Documentation</a>.</p>
</section>
<section id="code-quality-checks">
<h3>Code quality checks<a class="headerlink" href="#code-quality-checks" title="Link to this heading"></a></h3>
<p>We use black, flake8, isort to maintain a common style and check the code. Please check your code install the pre-commit hook:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pre-commit<span class="w"> </span>install
</pre></div>
</div>
<p>You can also check your changes manually:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pre-commit<span class="w"> </span>run<span class="w"> </span>--all-files
</pre></div>
</div>
<p>Testing with pytest</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest
</pre></div>
</div>
<p>You can generate a coverage report by running the following code block in your terminal. Please be aware that it might take a long time, think about lowering the number of steps in the sampling.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>coverage<span class="w"> </span>run<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>-v
coverage<span class="w"> </span>report
coverage<span class="w"> </span>html
</pre></div>
</div>
</section>
<section id="profiling-with-scalene">
<h3>Profiling with scalene<a class="headerlink" href="#profiling-with-scalene" title="Link to this heading"></a></h3>
<p>You can profile eulerpi with scalene (or gprofile) using the commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>scalene
scalene<span class="w"> </span>tests/profiling.py
</pre></div>
</div>
<p>This will create a <code class="docutils literal notranslate"><span class="pre">profile.html</span></code> file, which you can open using your browser. Do not rely on the OPENAI optimization proposals. They are often plain wrong in scalene.</p>
<!-- TODO: Add a docker development environment -->
<!-- - **Working with docker**:

  ```bash
  curl https://raw.githubusercontent.com/nektos/act/master/install.sh | sudo bash
  sudo service docker start
  sudo docker run hello-world
  sudo service docker stop
  ``` -->
</section>
<section id="documentation-with-sphinx">
<h3>Documentation with Sphinx<a class="headerlink" href="#documentation-with-sphinx" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>docs
sphinx-apidoc<span class="w"> </span>-e<span class="w"> </span>-f<span class="w"> </span>-o<span class="w"> </span>source/<span class="w"> </span>../
make<span class="w"> </span>html
</pre></div>
</div>
<p>All extensions of sphinx which are used to create this documentation and further settings are stored in the file <code class="docutils literal notranslate"><span class="pre">docs/source/conf.py</span></code>.
If you add extensions to <code class="docutils literal notranslate"><span class="pre">conf.py</span></code> which are not part of sphinx, add them to the <code class="docutils literal notranslate"><span class="pre">docs/source/requirement.txt</span></code> file to allow github action <code class="docutils literal notranslate"><span class="pre">mmaraskar/sphinx-action&#64;master</span></code> to still build the documentation.</p>
<p>A <a class="reference external" href="https://docs.typo3.org/m/typo3/docs-how-to-document/main/en-us/WritingReST/CheatSheet.html">cheatsheet</a> for reStructuredText with Sphinx.</p>
</section>
<section id="hosting-with-github-pages">
<h3>Hosting with GitHub Pages<a class="headerlink" href="#hosting-with-github-pages" title="Link to this heading"></a></h3>
<p>To publish the documentation on github pages you probably have to change some settings in the <a class="reference external" href="https://github.com/Systems-Theory-in-Systems-Biology/EPI">GitHub Repository</a></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Settings -&gt; Code and automation -&gt; Pages -&gt; Build and Deployment:
- Source: Deploy from a branch
- Branch: gh-pages &amp;&amp; /(root)
</pre></div>
</div>
</section>
<section id="changelog">
<h3>Changelog<a class="headerlink" href="#changelog" title="Link to this heading"></a></h3>
<p>We use the <a class="reference external" href="https://keepachangelog.com/en/1.0.0/">Keep a Changelog</a> format for the changelog. It should be updated with every pull request.</p>
</section>
<section id="versioning">
<h3>Versioning<a class="headerlink" href="#versioning" title="Link to this heading"></a></h3>
<p>We use <a class="reference external" href="https://semver.org/">Semantic Versioning</a>. A version number is composed of three parts: major.minor.patch</p>
<ol class="arabic simple">
<li><p>The major version should be incremented when you make incompatible changes.</p></li>
<li><p>The minor version should be incremented when you add new functionality in a backward-compatible manner.</p></li>
<li><p>The patch version should be incremented when you make backward-compatible bug fixes.</p></li>
</ol>
<p>Every time a new version is tagged, a GitHub Action workflow is triggered which builds and uploads the version to pypi.</p>
<p>Please update the version number in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file before tagging the version.</p>
</section>
<section id="test-deployment-with-testpypi">
<h3>Test Deployment with TestPyPi<a class="headerlink" href="#test-deployment-with-testpypi" title="Link to this heading"></a></h3>
<p>You have to set-up testpypi once:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>config<span class="w"> </span>repositories.testpypi<span class="w"> </span>https://test.pypi.org/legacy/
poetry<span class="w"> </span>config<span class="w"> </span>http-basic.testpypi<span class="w"> </span>__token__<span class="w"> </span>pypi-your-api-token-here
</pre></div>
</div>
<p>Build and deploy:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>build
poetry<span class="w"> </span>publish<span class="w"> </span>-r<span class="w"> </span>testpypi
</pre></div>
</div>
<p>Test this with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--index-url<span class="w"> </span>https://test.pypi.org/simple/<span class="w"> </span>--no-deps<span class="w"> </span>eulerpi
</pre></div>
</div>
</section>
<section id="deployment-with-pypi">
<h3>Deployment with PyPi<a class="headerlink" href="#deployment-with-pypi" title="Link to this heading"></a></h3>
<p>You have to set-up pypi once:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>config<span class="w"> </span>pypi-token.pypi<span class="w"> </span>pypi-your-token-here
</pre></div>
</div>
<p>Build and deploy:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>publish<span class="w"> </span>--build
</pre></div>
</div>
<p>Test this with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>eulerpi<span class="o">[</span>sbml<span class="o">]</span>
</pre></div>
</div>
</section>
</section>
<section id="jax-with-cuda">
<h2>Jax with CUDA<a class="headerlink" href="#jax-with-cuda" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://github.com/google/jax#pip-installation-gpu-cuda">Jax can be run with cuda on the gpu</a>. However, you need a recent nvidia-graphics-driver, the cuda-toolkit (cuda) and cudnn installed. Getting the versions right can cause headaches ;)</p>
<p>I used the following tricks to get it running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># for cuda toolkit</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_HOME</span><span class="o">=</span>/usr/local/cuda
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/cuda-12.0/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/cuda-12.0/lib64:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/cuda-11-fake/lib64:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Follow <a class="reference external" href="https://github.com/google/jax/issues/13637">this issue</a> to see whether you possibly need to create the cuda-11-fake folder as a copy from the 12.0 folder and “create the .so.11” libraries as symlinks using the script below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Find all files in the current directory that match the pattern &quot;lib*.so&quot;</span>
<span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>lib*.so<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="c1"># Extract the base name of the file (without the &quot;.so&quot; extension)</span>
<span class="w">    </span><span class="nv">base_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">file</span><span class="p">%.*</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Construct the name of the symbolic link we want to create</span>
<span class="w">    </span><span class="nv">link_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">base_name</span><span class="si">}</span><span class="s2">.so.11&quot;</span>

<span class="w">    </span><span class="c1"># Check if the link already exists</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$link_name</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># Create the symbolic link if it doesn&#39;t exist</span>
<span class="w">        </span>ln<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$link_name</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">done</span>
</pre></div>
</div>
<p>It can happen that old code is executed due to the generated pycache. For example, an old version of cuda or cudnn could be used. If you believe that this is happening:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>pyclean
py3clean<span class="w"> </span>.
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../examples/cpp_example.html" class="btn btn-neutral float-left" title="C++ Model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing to EPI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Vincent Wagner, Sebastian Höpfl, Lars Kaiser.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>